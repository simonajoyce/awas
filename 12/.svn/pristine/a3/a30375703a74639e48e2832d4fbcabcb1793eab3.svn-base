--------------------------------------------------------
--  File created - Thursday-September-19-2013
--------------------------------------------------------
--------------------------------------------------------
--  DDL for View XXAWAS_DEBTOR_AGEING_V
--------------------------------------------------------
CREATE OR REPLACE FORCE VIEW "APPS"."XXAWAS_DEBTOR_AGEING_V" ("BOOK", "CUSTOMER_NAME", "CUSTOMER_NUMBER", "TYPE", "PAYMENT_SCHED_ID", "CLASS", "DUE_DATE", "AMT_DUE_REMAINING", "AMT_DUE_ORIGINAL", "IN_DISPUTE", "DISPUTE_AMT", "DAYS_PAST_DUE", "Future", "1-30 Days", "1-7 Days", "8-15 Days", "8-30 Days", "16-30 Days", "31-60 Days", "60+ Days", "ENTITY", "MSN", "GL_ACCOUNT", "TRX_TYPE", "CUSTOMER_PROFILE")
AS
  SELECT DISTINCT DECODE(ps.org_Id,2,'AWAS',44,'PAFCO',85,'AWAS','UNKNOWN') BOOK,
    RTRIM(RPAD(SUBSTRB(party.party_name,1,50),36)) customer_name ,
    cust_acct.account_number customer_number ,
    TYPES.NAME TYPE ,
    ps.payment_schedule_id payment_sched_id ,
    ps.CLASS CLASS ,
    ps.due_date due_date ,
    DECODE( 'Y', 'Y', ps.acctd_amount_due_remaining, ps.amount_due_remaining ) amt_due_remaining,
    ps.amount_due_original amt_due_original ,
    CASE
      WHEN NVL(ps.amount_in_dispute,0) <> 0
      THEN 'Y'
      ELSE 'N'
    END IN_DISPUTE ,
    NVL(ps.amount_in_dispute,0) dispute_amt ,
    CEIL(SYSDATE                                                                                                                                                                                                                                                                        - ps.due_date ) days_past_due ,
    DECODE('X', 'DISPUTE_ONLY',DECODE(NVL(ps.amount_in_dispute,0),0,0,1), 'PENDADJ_ONLY',DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 'DISPUTE_PENDADJ',DECODE(NVL(ps.amount_in_dispute,0), 0,DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 1), DECODE( GREATEST(                -999999999, CEIL(SYSDATE-ps.due_date)), LEAST(0, CEIL(SYSDATE-ps.due_date)),1, 0) * DECODE(NVL(ps.amount_in_dispute,0), 0, 1, DECODE('X', 'DISPUTE_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)) * DECODE(NVL(ps.amount_adjusted_pending,0), 0, 1, DECODE('X', 'PENDADJ_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)))*ps.acctd_amount_due_remaining "Future",
    DECODE('X', 'DISPUTE_ONLY',DECODE(NVL(ps.amount_in_dispute,0),0,0,1), 'PENDADJ_ONLY',DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 'DISPUTE_PENDADJ',DECODE(NVL(ps.amount_in_dispute,0), 0,DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 1), DECODE( GREATEST(1, CEIL(SYSDATE -ps.due_date)), LEAST(30, CEIL(SYSDATE-ps.due_date)),1, 0) * DECODE(NVL(ps.amount_in_dispute,0), 0, 1, DECODE('X', 'DISPUTE_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)) * DECODE(NVL(ps.amount_adjusted_pending,0), 0, 1, DECODE('X', 'PENDADJ_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)))*ps.acctd_amount_due_remaining "1-30 Days" ,
    DECODE('X', 'DISPUTE_ONLY',DECODE(NVL(ps.amount_in_dispute,0),0,0,1), 'PENDADJ_ONLY',DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 'DISPUTE_PENDADJ',DECODE(NVL(ps.amount_in_dispute,0), 0,DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 1), DECODE( GREATEST(1, CEIL(SYSDATE -ps.due_date)), LEAST(7, CEIL(SYSDATE-ps.due_date)),1, 0) * DECODE(NVL(ps.amount_in_dispute,0), 0, 1, DECODE('X', 'DISPUTE_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)) * DECODE(NVL(ps.amount_adjusted_pending,0), 0, 1, DECODE('X', 'PENDADJ_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)))*ps.acctd_amount_due_remaining "1-7 Days" ,
    DECODE('X', 'DISPUTE_ONLY',DECODE(NVL(ps.amount_in_dispute,0),0,0,1), 'PENDADJ_ONLY',DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 'DISPUTE_PENDADJ',DECODE(NVL(ps.amount_in_dispute,0), 0,DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 1), DECODE( GREATEST(8, CEIL(SYSDATE -ps.due_date)), LEAST(15, CEIL(SYSDATE-ps.due_date)),1, 0) * DECODE(NVL(ps.amount_in_dispute,0), 0, 1, DECODE('X', 'DISPUTE_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)) * DECODE(NVL(ps.amount_adjusted_pending,0), 0, 1, DECODE('X', 'PENDADJ_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)))*ps.acctd_amount_due_remaining "8-15 Days" ,
    DECODE('X', 'DISPUTE_ONLY',DECODE(NVL(ps.amount_in_dispute,0),0,0,1), 'PENDADJ_ONLY',DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 'DISPUTE_PENDADJ',DECODE(NVL(ps.amount_in_dispute,0), 0,DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 1), DECODE( GREATEST(8, CEIL(SYSDATE -ps.due_date)), LEAST(30, CEIL(SYSDATE-ps.due_date)),1, 0) * DECODE(NVL(ps.amount_in_dispute,0), 0, 1, DECODE('X', 'DISPUTE_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)) * DECODE(NVL(ps.amount_adjusted_pending,0), 0, 1, DECODE('X', 'PENDADJ_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)))*ps.acctd_amount_due_remaining "8-30 Days" ,
    DECODE('X', 'DISPUTE_ONLY',DECODE(NVL(ps.amount_in_dispute,0),0,0,1), 'PENDADJ_ONLY',DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 'DISPUTE_PENDADJ',DECODE(NVL(ps.amount_in_dispute,0), 0,DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 1), DECODE( GREATEST(16, CEIL(SYSDATE-ps.due_date)), LEAST(30, CEIL(SYSDATE-ps.due_date)),1, 0) * DECODE(NVL(ps.amount_in_dispute,0), 0, 1, DECODE('X', 'DISPUTE_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)) * DECODE(NVL(ps.amount_adjusted_pending,0), 0, 1, DECODE('X', 'PENDADJ_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)))*ps.acctd_amount_due_remaining "16-30 Days" ,
    DECODE('X', 'DISPUTE_ONLY',DECODE(NVL(ps.amount_in_dispute,0),0,0,1), 'PENDADJ_ONLY',DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 'DISPUTE_PENDADJ',DECODE(NVL(ps.amount_in_dispute,0), 0,DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 1), DECODE( GREATEST(31, CEIL(SYSDATE-ps.due_date)), LEAST(60, CEIL(SYSDATE-ps.due_date)),1, 0) * DECODE(NVL(ps.amount_in_dispute,0), 0, 1, DECODE('X', 'DISPUTE_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)) * DECODE(NVL(ps.amount_adjusted_pending,0), 0, 1, DECODE('X', 'PENDADJ_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1))) *ps.acctd_amount_due_remaining "31-60 Days" ,
    DECODE('X', 'DISPUTE_ONLY',DECODE(NVL(ps.amount_in_dispute,0),0,0,1), 'PENDADJ_ONLY',DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 'DISPUTE_PENDADJ',DECODE(NVL(ps.amount_in_dispute,0), 0,DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 1), DECODE( GREATEST(61, CEIL(SYSDATE-ps.due_date)), LEAST(999999999999999999, CEIL(SYSDATE-ps.due_date)),1, 0) * DECODE(NVL(ps.amount_in_dispute,0), 0, 1, DECODE('X', 'DISPUTE_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)) * DECODE(NVL(ps.amount_adjusted_pending,0), 0, 1, DECODE('X', 'PENDADJ_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1))) *ps.acctd_amount_due_remaining "60+ Days" ,
    CC.sEGMENT1 ENTITY ,
    x.location MSN,
    NULL GL_Account ,
    TYPES.NAME TRX_TYPE ,
    DECODE(p.customer_profile_class_id, 1041,'Non Leasing','Leasing') Customer_Profile
  FROM ra_cust_trx_types_all TYPES,
    hz_cust_accounts cust_acct ,
    hz_parties party ,
    ar_payment_schedules_all ps ,
    hz_cust_site_uses_all X,
    hz_cust_acct_sites_all y,
    ra_cust_trx_LINE_gl_dist_all gld ,
    gl_code_combinations cc ,
    ar_customer_profiles_v p,
    ra_customer_trx_all r
  WHERE TRUNC(ps.gl_date)     <= SYSDATE
  AND ps.customer_id           = cust_acct.cust_account_id
  AND p.customer_id            = cust_acct.cust_account_id
  AND cust_acct.party_id       = party.party_id
  AND gld.customer_trx_id      = r.customer_trx_id
  AND r.bill_to_site_use_id    = x.site_Use_id
  AND x.site_use_id            = NVL(P.SITE_USE_ID, x.site_use_id)
  AND X.ORG_ID                 = 85
  AND y.cust_account_id        = cust_acct.cust_account_id
  AND x.cust_acct_site_id      = y.cust_acct_site_id
  AND ps.cust_trx_type_id      = TYPES.cust_trx_type_id
  AND NVL(ps.org_id,-99)       = NVL(TYPES.org_id,-99)
  AND ps.gl_date_closed        > SYSDATE
  AND ps.customer_trx_id+0     = gld.customer_trx_id
  AND gld.account_class        = 'REC'
  AND gld.code_combination_id  = cc.code_combination_id
  AND PS.ORG_ID                = TYPES.ORG_ID
  AND TYPES.ORG_ID             = GLD.ORG_ID
  AND gld.code_combination_id IN
    (SELECT code_combination_id
    FROM ra_cust_trx_LINE_gl_dist_all
    WHERE account_class      = 'REC'
    AND ps.customer_trx_id+0 = customer_trx_id
    GROUP BY customer_trx_id,
      code_combination_id
    HAVING SUM(amount) <> 0
    )
  UNION ALL
  SELECT DISTINCT DECODE(ps.org_Id,2,'AWAS',44,'PAFCO','UNKNOWN') BOOK ,
    RTRIM(RPAD(SUBSTRB(party.party_name,1,50),36)) customer_name ,
    cust_acct.account_number customer_number ,
    'ON ACCOUNT' TYPE ,
    ps.payment_schedule_id payment_sched_id ,
    ps.CLASS CLASS ,
    ps.due_date due_date ,
    DECODE( 'Y', 'Y', ps.acctd_amount_due_remaining, ps.amount_due_remaining ) amt_due_remaining,
    ps.amount_due_original amt_due_original ,
    CASE
      WHEN NVL(ps.amount_in_dispute,0) <> 0
      THEN 'Y'
      ELSE 'N'
    END IN_DISPUTE ,
    NVL(ps.amount_in_dispute,0) dispute_amt ,
    CEIL(SYSDATE                                                                                                                                                                                                                                                                        - ps.due_date ) days_past_due ,
    DECODE('X', 'DISPUTE_ONLY',DECODE(NVL(ps.amount_in_dispute,0),0,0,1), 'PENDADJ_ONLY',DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 'DISPUTE_PENDADJ',DECODE(NVL(ps.amount_in_dispute,0), 0,DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 1), DECODE( GREATEST(                -999999999, CEIL(SYSDATE-ps.due_date)), LEAST(0, CEIL(SYSDATE-ps.due_date)),1, 0) * DECODE(NVL(ps.amount_in_dispute,0), 0, 1, DECODE('X', 'DISPUTE_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)) * DECODE(NVL(ps.amount_adjusted_pending,0), 0, 1, DECODE('X', 'PENDADJ_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)))*ps.acctd_amount_due_remaining "Future",
    DECODE('X', 'DISPUTE_ONLY',DECODE(NVL(ps.amount_in_dispute,0),0,0,1), 'PENDADJ_ONLY',DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 'DISPUTE_PENDADJ',DECODE(NVL(ps.amount_in_dispute,0), 0,DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 1), DECODE( GREATEST(1, CEIL(SYSDATE -ps.due_date)), LEAST(30, CEIL(SYSDATE-ps.due_date)),1, 0) * DECODE(NVL(ps.amount_in_dispute,0), 0, 1, DECODE('X', 'DISPUTE_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)) * DECODE(NVL(ps.amount_adjusted_pending,0), 0, 1, DECODE('X', 'PENDADJ_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)))*ps.acctd_amount_due_remaining "1-30 Days" ,
    DECODE('X', 'DISPUTE_ONLY',DECODE(NVL(ps.amount_in_dispute,0),0,0,1), 'PENDADJ_ONLY',DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 'DISPUTE_PENDADJ',DECODE(NVL(ps.amount_in_dispute,0), 0,DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 1), DECODE( GREATEST(1, CEIL(SYSDATE -ps.due_date)), LEAST(7, CEIL(SYSDATE-ps.due_date)),1, 0) * DECODE(NVL(ps.amount_in_dispute,0), 0, 1, DECODE('X', 'DISPUTE_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)) * DECODE(NVL(ps.amount_adjusted_pending,0), 0, 1, DECODE('X', 'PENDADJ_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)))*ps.acctd_amount_due_remaining "1-7 Days" ,
    DECODE('X', 'DISPUTE_ONLY',DECODE(NVL(ps.amount_in_dispute,0),0,0,1), 'PENDADJ_ONLY',DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 'DISPUTE_PENDADJ',DECODE(NVL(ps.amount_in_dispute,0), 0,DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 1), DECODE( GREATEST(8, CEIL(SYSDATE -ps.due_date)), LEAST(15, CEIL(SYSDATE-ps.due_date)),1, 0) * DECODE(NVL(ps.amount_in_dispute,0), 0, 1, DECODE('X', 'DISPUTE_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)) * DECODE(NVL(ps.amount_adjusted_pending,0), 0, 1, DECODE('X', 'PENDADJ_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)))*ps.acctd_amount_due_remaining "8-15 Days" ,
    DECODE('X', 'DISPUTE_ONLY',DECODE(NVL(ps.amount_in_dispute,0),0,0,1), 'PENDADJ_ONLY',DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 'DISPUTE_PENDADJ',DECODE(NVL(ps.amount_in_dispute,0), 0,DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 1), DECODE( GREATEST(8, CEIL(SYSDATE -ps.due_date)), LEAST(30, CEIL(SYSDATE-ps.due_date)),1, 0) * DECODE(NVL(ps.amount_in_dispute,0), 0, 1, DECODE('X', 'DISPUTE_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)) * DECODE(NVL(ps.amount_adjusted_pending,0), 0, 1, DECODE('X', 'PENDADJ_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)))*ps.acctd_amount_due_remaining "8-30 Days" ,
    DECODE('X', 'DISPUTE_ONLY',DECODE(NVL(ps.amount_in_dispute,0),0,0,1), 'PENDADJ_ONLY',DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 'DISPUTE_PENDADJ',DECODE(NVL(ps.amount_in_dispute,0), 0,DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 1), DECODE( GREATEST(16, CEIL(SYSDATE-ps.due_date)), LEAST(30, CEIL(SYSDATE-ps.due_date)),1, 0) * DECODE(NVL(ps.amount_in_dispute,0), 0, 1, DECODE('X', 'DISPUTE_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)) * DECODE(NVL(ps.amount_adjusted_pending,0), 0, 1, DECODE('X', 'PENDADJ_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)))*ps.acctd_amount_due_remaining "16-30 Days" ,
    DECODE('X', 'DISPUTE_ONLY',DECODE(NVL(ps.amount_in_dispute,0),0,0,1), 'PENDADJ_ONLY',DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 'DISPUTE_PENDADJ',DECODE(NVL(ps.amount_in_dispute,0), 0,DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 1), DECODE( GREATEST(31, CEIL(SYSDATE-ps.due_date)), LEAST(60, CEIL(SYSDATE-ps.due_date)),1, 0) * DECODE(NVL(ps.amount_in_dispute,0), 0, 1, DECODE('X', 'DISPUTE_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)) * DECODE(NVL(ps.amount_adjusted_pending,0), 0, 1, DECODE('X', 'PENDADJ_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1))) *ps.acctd_amount_due_remaining "31-60 Days" ,
    DECODE('X', 'DISPUTE_ONLY',DECODE(NVL(ps.amount_in_dispute,0),0,0,1), 'PENDADJ_ONLY',DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 'DISPUTE_PENDADJ',DECODE(NVL(ps.amount_in_dispute,0), 0,DECODE(NVL(ps.amount_adjusted_pending,0),0,0,1), 1), DECODE( GREATEST(61, CEIL(SYSDATE-ps.due_date)), LEAST(999999999999999999, CEIL(SYSDATE-ps.due_date)),1, 0) * DECODE(NVL(ps.amount_in_dispute,0), 0, 1, DECODE('X', 'DISPUTE_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1)) * DECODE(NVL(ps.amount_adjusted_pending,0), 0, 1, DECODE('X', 'PENDADJ_ONLY', 0, 'DISPUTE_PENDADJ', 0, 1))) *ps.acctd_amount_due_remaining "60+ Days" ,
    CC.sEGMENT1 ENTITY ,
    cc.segment5 MSN ,
    NULL GL_Account ,
    'ON_ACCOUNT' TRX_TYPE ,
    DECODE(p.customer_profile_class_id, 1041,'Non Leasing','Leasing') Customer_Profile
  FROM ar_payment_schedules_all ps ,
    ar_receivable_applications_all app,
    gl_code_combinations cc ,
    hz_cust_accounts cust_acct ,
    hz_parties party ,
    hz_cust_site_uses_all site ,
    hz_cust_acct_sites_all addr ,
    hz_party_sites party_site ,
    hz_locations loc ,
    ar_customer_profiles_v p
  WHERE app.gl_date+0                      <= sysdate
  AND p.customer_id                         = cust_acct.cust_account_id
  AND ps.customer_id                        = cust_acct.cust_account_id(+)
  AND cust_acct.party_id                    = party.party_id(+)
  AND ps.cash_receipt_id     +0             = app.cash_receipt_id
  AND ps.customer_site_use_id+0             = site.site_use_id(+)
  AND site.cust_acct_site_id                = addr.cust_acct_site_id(+)
  AND addr.party_site_id                    = party_site.party_site_id(+)
  AND loc.location_id(+)                    = party_site.location_id
  AND app.code_combination_id               = cc.code_combination_id
  AND app.status                           IN ( 'ACC', 'UNAPP', 'UNID', 'OTHER ACC')
  AND NVL(app.confirmed_flag, 'Y')          = 'Y'
  AND ps.gl_date_closed                     > sysdate
  AND display                               = 'Y'
  AND ((app.reversal_gl_date               IS NOT NULL
  AND ps.gl_date                           <= sysdate)
  OR app.reversal_gl_date                  IS NULL )
  AND NVL( ps.receipt_confirmed_flag, 'Y' ) = 'Y'
  AND addr.org_id                           = 85
  AND PS.ORG_ID                             = app.ORG_ID ;
